<HTML>
<HEAD><TITLE>BICEP: POINTING</TITLE>
<LINK REV="made" HREF="mailto:tjp@astro.caltech.edu">
</HEAD>

<BODY bgcolor="#ffffff">
<H1>POINTING</H1>

POINTING is for analyzing BICEP optical pointing data.

<h2>Usage</h2>

<PRE>
% ~tjp/bin/pointing [<i>directory</i>] [<i>cal_file</i>]
</PRE>

<p><i>directory</i> specifies the directory containing the archive
files; the default is <code>$BICEP_ARC_DIR</code>.</p>

<p><i>cal_file</i> specifies a BICEP cal file to be applied to the
data; the default is <code>$BICEP/conf/cal</code>.</p>

<H2>Pointing Model</H2>

The telescope pointing model is specified by a number of parameters, as
follows:
<TABLE>
<TR><TD>0</TD> <TD>Flexure parameter</TD></TR>
<TR><TD>1</TD> <TD>AZ axis tilt in HA direction</TD></TR>
<TR><TD>2</TD> <TD>AZ axis tilt in latitude direction</TD></TR>
<TR><TD>3</TD> <TD>EL axis tilt (non-perpendicularity)</TD></TR>
<TR><TD>4</TD> <TD>Collimation error (magnitude)</TD></TR>
<TR><TD>5</TD> <TD>Direction of collimation error [deg]</TD></TR>
<TR><TD>6</TD> <TD>AZ encoder offset</TD></TR>
<TR><TD>7</TD> <TD>EL encoder offset</TD></TR>
<TR><TD>8</TD> <TD><i>Reserved</i></TD></TR>
<TR><TD>9</TD> <TD><i>Reserved</i></TD></TR>
<TR><TD>A</TD> <TD>x tilt-meter zero point</TD></TR>
<TR><TD>B</TD> <TD>y tilt-meter zero point</TD></TR>
</TABLE>

<p>POINTING allows the user to investigate the effects of changing these
parameters, and to do a least-squares fit to adjust the parameters to
minimize the rms residual position error.</P>

<H2>Commands</H2>

<p>Commands are not case-sensitive. They may be abbreviated (minimum
match). Optional arguments are indicated by square brackets.</p>

<h3>Index</h3>

<p>
<a href="#append">append</a>,
<a href="#calfile">calfile</a>,
<a href="#check">check</a>,
<a href="#clip">clip</a>, 
<a href="#colorize">colorize</a>,
<a href="#directory">directory</a>,
<a href="#enccor">enccor</a>, 
<a href="#exit">exit</a>,
<a href="#fit">fit</a>, 
<a href="#help">help</a>, 
<a href="#mark">mark</a>,
<a href="#model">model</a>,
<a href="#plot">plot</a>,
<a href="#pseudodata">pseudodata</a>,
<a href="#quit">quit</a>,
<a href="#read">read</a>,
<a href="#reset">reset</a>,
<a href="#rotcor">rotcor</a>, 
<a href="#save">save</a>,
<a href="#select">select</a>,
<a href="#set">set</a>, 
<a href="#symbol">symbol</a>, 
<a href="#tfit">tfit</a>,
<a href="#tilt">tilt</a>,
<a href="#tiltfactors">tiltfactors</a>,
<a href="#tiltmx">tiltmx</a>,
<a href="#tiltmy">tiltmy</a>,
<a href="#unflag">unflag</a>,
<a href="#utrange">utrange</a>,
<a href="#xylimit">xylimit</a>.
</p> 


<H3>General</H3>

<DL>

<DT><a name="help"><B>help</B></a>
<DD>
The <i>help</i> command asks Netscape to display this file.<P>

<DT><a name="exit"><b>exit</b></a>
<DT><a name="quit"><b>quit</b></a>
<DD>Exit from program.

</DL>

<H3>Reading Data</H3>

<DL>

<DT><a name="read"><B>read [<i>start_utc</i>] [<i>end_utc</i>]</b></a>
<DD>
Extract pointing data from BICEP archive files. The program locates
``pointing'' frames (those with mark <b>f0</b> set) and records the
AZ, EL, deck angle, pointing model, etc., from those frames. The
<b>mark</b> command can be used to specify a different mark to
select. [The program also looks at frames with mark <b>f4</b> set; see
the discussion of tilt meters below.]<P>

<i>start_utc</i> and <i>end_utc</i> specify a UTC time range in the
format dd-MMM-yyyy:hh:mm:ss.  If <i>start_utc</i> is omitted, the
start time will default to the earliest time available. If 
<i>end_utc</i> is omitted, the end time will default to the latest time available. If both <i>start_utc</i> and <i>end_utc</i> are omitted, the program
reads all available data. If the date
field is omitted in <i>end_utc</i>, it is taken from
<i>start_utc</i>; e.g.,
<PRE>
  read 30-nov-1998 1-dec-1998
  read 30-nov-1998:08:30 09:00
</PRE>
Dates must be complete, including a 4-digit year. Times can be omitted
or truncated.<P>

<B>Note:</B> Each time you use this command, a file
<code>pointing-logfile.txt</code> is created in the current directory,
listing the data found (time, AZ, EL, deck angle, AZ offset, EL
offset, and star name). If the file already exists, it will be
overwritten.<P>

<DT><a name="append"><B>append [<i>start_utc</i>] [<i>end_utc</i>]</b></a>
<DD>
This is like the <b>read</b> command, but it adds to the dataset in
memory, rather than loading a new dataset. <b>Caution:</b> If this is
used after encoder corrections have been applied (<b>enccor</b>
command) you will end up with a dataset that has been partially
corrected.<P>

<dt><a name="directory"><b>directory <i>directory</i></b></a>
<dd>
Change the archive directory for subsequent <b>read</b> commands. If
this command is not used, the directory is taken from the command line
used to start the program, or from environment variable
<code>$BICEP_ARC_DIR</code>.
<p>

<dt><a name="calfile"><b>calfile <i>cal_file</i></b></a>
<dd>
Change the calibration file for subsequent <b>read</b> commands.  If
this command is not used, the directory is taken from the command line
used to start the program, or from
<code>$BICEP/conf/cal</code>.
<p>

<DT><a name="mark"><B>mark <i>number</i></B></a>
<DD>
This commands specifies that subsequent <b>read</b> commands should
select frames with the specified mark set. The argument <i>number</i>
is an integer 0-31 corresponding to mark f0-f31. The default is 0.<P>

<DT><a name="check"><B>check 0 | 1</B></a>
<DD>
This command affects subsequent <b>read</b> commands: if check=1, the
program recomputes the pointing model and prints out a comparison of
its calculations with the calculation used by the online program. They
should agree.
</DL>

<H3>Plotting</H3>

<DL>

<DT><a name="plot"><B>plot points [<i>device</i>]</B></a>
<DD>
Plot the observed star positions (AZ and EL) on the sky in an equal-area
projection centered on the zenith.<P>

The optional argument <i>device</i> specifies a PGPLOT graphics
device.  If it is omitted, an X-window is used (device
<code>/XSERVE</code>), For hardcopy, use <code>filename/CPS</code> or
<code>filename/VCPS</code> to create a file in PostScript format
(landscape or portrait orientation). Note that if the file specified
by <code>filename</code> already exists, it will be overwritten.<P>

<DT><B>plot corr [<i>device</i>]</B>
<DD>
Plot the total pointing corrections applied by the online system
versus AZ, EL, and deck angle. These corrections are those required to
convert ideal <i>topocentric</i> coordinates to the <i>mount</i>
(encoder) coordinates allowing for departures from ideal.<P>

<DT><B>plot off [<i>device</i>]</B>
<DD>
Plot the encoder offsets applied by the online system versus AZ, EL,
and deck angle. The total corrections plotted by ``plot corr''  are the
encoder offsets plus additional terms due to axis misalignment,
collimation error, and flexure.<P>

<DT><B>plot model [<i>device</i>]</B>
<DD>
Plot the pointing corrections required by the current model versus AZ,
EL, and deck angle. Initially, the current model is that in use in the
online system at the end of the observing period, but it can be
modified by other commands.<P>

<DT><B>plot res [<i>device</i>]</B>
<DD>
Plot the AZ and EL residuals versus AZ, EL, and deck angle. The
residuals are the differences between the current model
(cf. plot model) and the online corrections (cf. plot corr), and for a
perfect model they should be zero.<P>

<DT><B>plot tilt [<i>device</i>]</B>
<DD>
Plot the tilt-meter readings (x and y) versus AZ, EL, and deck angle.
The points plotted are the tilt-meter readings taken at the times the
pointing offsets were recorded.<P>

<DT><B>plot ctilt [<i>device</i>]</B>
<DD>
Plot the <i>corrected</i> tilt-meter readings (x and y) versus AZ, EL,
and deck angle. The readings are corrected by subtracting a zero-point
and sinusoidal dependence on AZ.<P>

<DT><B>plot xxtilt [<i>device</i>]</B>
<DD>
Compare the X1 and X2 tilt-meters; this command plots X2 versus X1 and
X2-X1 versus elevation.<P>

<DT><B>plot ctt [<i>device</i>]</B>
<DD>
Plot the <i>corrected</i> tilt-meter readings (x and y) versus UTC.<P>

<DT><B>plot rot [<i>device</i>]</B>
<DD>
Plot the readings from the two gauges used to monitor elevation shaft
rotation and elevation encoder body rotation versus AZ, EL, and deck
angle.  The points plotted are the readings taken at the times the
pointing offsets were recorded.<P>

<DT><B>plot weather [<i>device</i>]</B>
<DD>
Plot data from the weather station versus time (UTC): air temperature,
pressure, humidity, wind speed, and wind direction.<P>

<DT><B>plot xy [<i>device</i>]</B>
<DD>
Plot EL residual versus AZ residual (scaled by cos(EL) to show errors
on the sky). The axis range is is set by the <i>xylimit</i>
command.<P>

<DT><B>plot ut [<i>device</i>]</B>
<DD>
Plot AZ, EL, deck angle, AZ residual, and EL residual versus time
(UTC).<P>

<DT><B>plot lst [<i>device</i>]</B>
<DD>
Plot AZ, EL, deck angle, AZ residual, and EL residual versus local sidereal time (LST).<P>

<DT><B>plot enc [<i>]device</i>]</B>
<DD>This command generates plots of the EL residuals versus EL, deck
angle, and UTC, together with comparable plots of the difference
between the elevation axis encoder reading and the elevation deduced
from the elevation motor encoder.<P>

<DT><a name="utrange"><B>utrange <i>start-utc end-utc</i></B></a>
<DD>
Sets the UT range for <i>tplot</i> plots; it does not affect other
plots. Can be used to zoom in on a subrange of the dataset. Both
parameters must be specified; the syntax is the same as in the
<i>read</i> command.<P>

<DT><a name="xylimit"><B>xylimit <i>range</i></B></a>
<DD>
Set the axis limit for the <i>plot xy</i> command. The argument
<i>range</i> specifies the range of each coordinate to display, in
arcsec (the axis runs from -<i>range</i> to +<i>range</i>).
<P>

<DT><a name="colorize"><B>colorize <i>scheme</i></B></a>
<DD>
This command can be used before one of the <b>plot</b> commands to
specify how color should be used to distinguish the points. The
options for parameter <i>scheme</i> are -1 (all points black), 0
(all points red); 1 (different colors for different UT days); 2 (default:
color changes after a gap of 4 hours of more with no points);
3 (different colors for different stars).

<DT><a name="symbol"><B>symbol <i>marker_number</i></B></a>
<DD>
By default, the <b>plot</b> commands use different symbols (graph
markers) to distinguish different stars. Alternatively, a single
symbol can be used for all stars. To specify the symbol number, use
the <b>symbol</b> command, e.g., <b>symbol 2</b> for a + sign. To
restore the default behavior, use <b>symbol 0</b>. See the PGPLOT
documentation for a list of available symbols.

</DL>

<H3>Interactive Plotting</H3>

The <b>plot res</b>, <b>plot ut</b>, and <b>plot lst</b> displays allow
interactive zooming and editing.
First, position the cursor in any
one of the panels and type and key (except H or X) or click any mouse
button (except the right button).  The selected panel will be
replotted at full scale. You then have the following options:
<DL>
<DT><B>Zoom (Z)</B>
<DD>Position the cursor at one corner of the region of interest and type Z; then position the cursor at the opposite corner and type any character
except D (middle button) to zoom in on the region. Typing D cancels the zoom
in progress.
<DT><B>Unzoom (U)</B>
<DD>Type U to redraw the plot on the default scale.
<DT><B>Flag inside (F)</B>
<DD>To flag all the points within a rectangle: position the cursor at one corner of the region of interest and type F; then position the cursor at the opposite corner and type  any character
except D (middle button) to zoom in on the region. Typing D cancels the flag operation.
<DT><B>Flag outside (A)</B>
<DD>To flag all the points within a rectangle: position the cursor at one corner of the region of interest and type A (left mouse button); then position the cursor at the opposite corner and type  any character
except D (middle button) to zoom in on the region. Typing D cancels the flag operation.
<DT><B>Restore flagged points (R)</B>
<DD>Type R to restore all flagged points.
<DT><B>Line mode (L)</B>
<DD>Type L to redraw the plot with a line joining the points (in time
order). Type L again to remove the line.
<DT><B>Symbol mode (S)</B>
<DD>Type S to redraw the plot with the same symbol for all stars. Type S
again to draw the plot with different symbols for each star.
<DT><B>Save PostScript file (P)</B>
<DD>Type P to save the current plot in a PostScript file. The program will
prompt for a PGPLOT device specification, e.g., <code>plot.ps/cps</code>.
</DL>

<H3>Changing the Model</H3>

<DL>

<DT><a name="set"><B>set <i>parameter</i> <i>value</i></B></a>
<DD>This command modifies one of the parameters of the current
    model. <i>parameter</i> is an integer in the range 0 to 7, specifying the
    number of the parameter, and <i>value</i> is the new value (in
    degrees).<P>

<DT><a name="model"><B>model <i>value0 value1...</i></B></a>
<DD>
This command can be used to set all the parameters simultaneously; the
parameters must be listed in order. The values are in arcsec, excpet
for the collimation error orientation, which is in degrees. If no
values are given, all parameters are displayed in a format suitable for
re-entry with the <b>model</b> command.<P>

<DT><a name="fit"><B>fit [<i>parameters</i>]</b></a>
<DD>
Adjust model parameters to minimize the rms of the sky residuals;
i.e., determine the best-fit model. <i>parameters</i> is a string of
digits 0-9AB indicating the parameters to be adjusted; if it is
omitted, parameters 01234567 are adjusted, and the others (89AB) are
held constant.<P>

Each variable parameter in turn is incremented or decremented in the
direction that reduces the rms residual until a minimum is found;
after all parameters have been adjusted, the process is repeated until
the variance of the residuals (chi-squared) decreases by less than
0.5%. (This is essentially the algorithm GRIDLS of Bevington.)<P>

<DT><a name="reset"><b>reset</b></a>
<DD>
This command resets all model parameters to the initial values, i.e.,
those in use online at the end of the observing period.
<p>

<dt><a name="save"><b>save [<i>filename</i>]</b></a>
<dd>
Save the current pointing parameters in the specified file, in a
format suitable for input to the control program (viewer). If no
file name is specified, the program will try to create file
<code>/home/bicep/conf/pointing_commands</code>. Example file:
<pre>
# UT range 07-NOV-1999 23:41:15 to 10-NOV-1999 01:00:27
# Tilt meters: 0 (disabled); scale factors x=1.000, y=1.000
# RotCor: 0.00 0.00
# Residuals: rms AZ=11.9, AZcos(EL)=3.9, EL=5.2, sky=6.5; max=16.2 arcsec
collimate optical, 0.31173, 129.60
tilts     -0.01094, 0.00257, -0.01177
flexure   0.00188
encoder_zero_points 1.75733, -0.83926, 0.0
</pre>
The tilt meter factors and rotcor factors are not saved as commands,
because the current control program cannot apply these corrections
online.

<p>To change the online pointing parameters by loading the commands
saved in <code>/home/bicep/conf/pointing_commands</code>, execute the
following command in viewer:
<pre>
schedule pointing_update
</pre>

</DL>

<H3>Using the Tilt Meters</H3>

<p>There are (as of January 1, 2000) two tilt meters. The first is
located on the azimuth axis, and gives readings (X1,Y). The second is
located below the elevation bearing, and gives reading X2 (the
corresponding Y reading is not available). The second meter should be
read with the telescope halted. The program looks for archive frames
with mark <b>f4</b> set, and associates the X2 reading from such a
frame with the immediately preceding star measurement in a frame with
<b>f0</b> set. If no f4 frame follows an f0 frame, the X2 reading used
is that taken at the time of the star measurement with the telescope
tracking; this may not be accurate.</p>

<p>Use the following commands to specify how the tilt meter readings
should be used in the pointing model.</p>

<DL>

<DT><a name="tilt"><b>tilt 0|1</b></a>
<DD>
Specify <b>tilt 1</b> to include the tilt-meter readings in the
pointing model.  Specify <b>tilt 0</b> to ignore them; in this case,
parameters A and B have no effect.
<p>

<DT><a name="tiltfactors"><b>tiltfactors <i>x1factor x2factor yfactor</i></b></a>
<DD>
These factors multiply the tilt meter readings before they are
applied in the pointing model. The default values are 1, 0, 1. Values
of 0, 0, 0 are equivalent to specifying <b>tilt 0</b>. To select the X1,Y tilt meters, use 1, 0, 1. To select the X2,Y tilt meters, use 0, 1, 1.
</dl>

The following commands have no effect on the pointing model, but they
can be used in conjunction with <b>plot ctilt</b> and <b>plot ctt</b>
to investigate how the tilt meter readings vary with telescope
position.

<dl>

<DT><a name="tfit"><B>tfit <i>type</i></B></a>
<DD>
This command fits <i>either</i> a sinusoidal model to the tilt-meter
readings as a function of azimuth (two different models can be
fitted); <i>or</i> a model for the dependence of x-tilt on
elevation. The models are linear in the parameters and thus minimizing
chi-squared requires no iteration. The model affects <b>plot ctilt</b> and
<b>plot ctt</b>.
 <DL>
 <DT><B>tfit 0</B>
 <DD>This removes any current tilt model.
 <DT><B>tfit 2</B>
 <DD>This fits the <i>x</i> and <i>y</i> meters independently, with functional
 form <i>x</i> = <i>a</i> + <i>b</i> sin <i>az</i> + <i>c</i> cos <i>az</i>,
 for a total of 6 parameters.
 <DT><B>tfit 1</B>
 <DD>This constrains the two meters to have the same amplitude and
 phases that differ by 90°, so there are four adjustable parameters: the zero
points of <i>x</i> and <i>y</i>, the amplitude, and the phase.
 <DT><B>tfit 3</B>
 <DD>This fits a model of the form <i>x,y</i> = <i>a</i> + <i>b</i> cos <i>el</i>.
 <DT><B>tfit 4</B>
 <DD>This fits a model of the form<br>
  <i>x</i> = <i>a</i> + <i>b</i> sin <i>az</i> + <i>c</i> cos <i>az</i> + <i>d</i> cos <i>el</i>,<br>
  <i>y</i> = <i>e</i> + <i>c</i> cos <i>az</i> - <i>b</i> sin <i>az</i> + <i>f</i> cos <i>el</i>,<br>
 where <i>a</i> and <i>e</i> are the zero-points of the tilt meters, <i>b</i> and <i>c</i>
 represent a fixed tilt of the az platform, and <i>d</i> and <i>f</i> represent
 additional tilting as elevation is changed. (Although this is a linear model,
 the program uses an iterative algorithm so the result may depend on the
 starting point.)
 </DL>
<p>

<DT><a name="tiltmx"><B>tiltmx <i>p1 p2 p3 p4</i></B></a>
<DD>
This command can be used to set the coefficients of the <i>x</i>tilt-meter model,<br>
  <i>x</i> = <i>p1</i> + <i>p2</i> sin <i>az</i> + <i>p3</i> cos <i>az</i> + <i>p4</i> cos <i>el</i>.<br>
The command <b>tiltmx</b> with no arguments reports the current coefficients, e.g., set by <b>tfit</b>.
<p>

<DT><a name="tiltmy"><B>tiltmy <i>p1 p2 p3 p4</i></B></a>
<DD>
This command can be used to set the coefficients of the <i>y</i>tilt-meter model,<br>
  <i>y</i> = <i>p1</i> + <i>p2</i> sin <i>az</i> + <i>p3</i> cos <i>az</i> + <i>p4</i> cos <i>el</i>.<br>
The command <b>tiltmy</b> with no arguments reports the current coefficients, e.g., set by <b>tfit</b>.



</DL>

<H3>Editing Data</H3>

Flagged points are excluded when fitting parameters and estimating the
rms residuals.

<DL>

<DT><a name="select"><B>select <i>dk</i></B></a>
<DD>
This command flags all points not observed at the specified deck angle
offset (degrees).<P>

<DT><a name="clip"><b>clip [<i>level</i>]</b></a>
<DD>
This command flags all points with a residual greater than
<i>level</i> times the sky rms. The default for <i>level</i> is 2.0 (2
sigma).<P>

<DT><a name="unflag"><b>unflag</b></a>
<DD>This command marks all points as unflagged and can be used to undo the
effects of overly zealous clipping.<P>

<DT><a name="pseudodata"><B>pseudodata [<i>rms</i>]</B></a>
<DD>This command is used for simulations. It causes the observed data
(obtained with the <i>read</i> command) to be replaced by artificial
data that fit the current model, with (optional) additive noise with
standard deviation <i>rms</i> arcsec in each of az and el.  The artificial
data have the same sampling in time, az, and el as the real data they
replace.  Typically one might use this command to get artificial data
that fit the model, and then change one or more model parameters (using
<i>set</i>) to see the effect of an error, or to see how well
<i>fit</i> can recover the original parameters.<P>

<DT><a name="enccor"><B>enccor</B></a>
<DD>
This command corrects the elevation offsets for the difference between
the elevation axis encoder and the elevation motor encoder. To undo
the correction, issue a new <i>read</i> command.
<P>

<DT><a name="rotcor"><B>rotcor <i>factor1 factor2</i></b></a>
<DD>
This command corrects the elevation offsets for rotation of the
encoder.  Measured elevation errors are corrected by subtracting
<i>factor1</i> times pmac.el_enc_rot[0] and <i>factor2</i> times
pmac.el_enc_rot[1]. These quantities are [0] the rotation of the base
of the encoder mount relative to the deck, and [1] the rotation of the
elevation shaft relative to the azimuth platform.  Nominally both
factors should be 1.0. Any previous <b>rotcor</b> corrections are
removed before applying the new ones. To remove the corrections
entirely, use command <b>rotcor 0 0</b>.

</DL>

<HR>
<ADDRESS>
Tim Pearson, California Institute of Technology<BR>
<A HREF="mailto:tjp@astro.caltech.edu">tjp@astro.caltech.edu</A>
</ADDRESS>
</BODY>
</HTML>
